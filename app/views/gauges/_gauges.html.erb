<div id="gauges">
  <%= link_to_remote(l(:label_previous), :update => "gauges",
    :url => {:action => :prev_week, :base_date => @base_date}) %>
  <%= link_to_remote(l(:label_next), :update => "gauges",
    :url => {:action => :next_week, :base_date => @base_date}) %>
  <table class="list">
    <tr>
      <th><%= l(:label_member) %></th>
      <% get_week(@base_date).each do |date| %>
        <th><%= date.strftime("%m/%d") %></th>
      <% end %>
    </tr>
    <% @members.each do |member| %>
    <tr class="<%= cycle('odd', 'even') %>">
      <td><%= "#{member.user.firstname} #{member.user.lastname}" %></td>
      <% get_week(@base_date).each do |date| %>
        <% drop_receiving_id = "drop|#{member.id.to_s}|#{date.to_s}" %>
        <td id='<%= "#{member.id.to_s}-#{date.to_s}" %>'>
          <%= progress_bar([member.closed_pourcent_by_date(date), member.completed_pourcent_by_date(date)], :width => '100%') %>
          <%= member.closed_issues_by_date(date).size %> / <%= member.issues_by_date(date).size %>
          <%= drop_receiving_element drop_receiving_id,
            :update => 'gauges',
            :with => "'dropped=' + element.id",
            :hoverclass => "hover",
            :url => { :action => "move_issue",
              :where => "#{member.id.to_s}|#{date.to_s}",
              :base_date => @base_date
            }
          %>
        </td>
        <% if member.issues_by_date(date).size > 0 then %>
          <script language="javascript">
            j$('#<%= "#{member.id.to_s}-#{date.to_s}" %>').qtip({
              content: '<%= issues_tip(member.issues_by_date(date)) %>',
              position: {
                corner: {
                  target: 'topMiddle',
                  tooltip: 'bottomMiddle'
                }
              },
              style: {
                border: {
                  width: 7,
                  radius: 7
                },
                tip: 'bottomMiddle',
                name: 'light'
              },
              show: 'mouseover',
              hide: {
                when: 'mouseout',
                effect: {
                  type: 'fade',
                  length: 500
                }
              }
            });
          </script>
        <% end %>
      <% end %>
    </tr>
    <% end %>
  </table>
  <input type="hidden" name="base_date" value="<%= @base_date.to_s %>">
</div>
